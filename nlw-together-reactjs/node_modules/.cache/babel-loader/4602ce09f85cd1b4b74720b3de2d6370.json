{"ast":null,"code":"import _regeneratorRuntime from\"/home/brenoangelo/Documents/rocketseat/nwl-together-reactjs/letmeask/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/brenoangelo/Documents/rocketseat/nwl-together-reactjs/letmeask/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/brenoangelo/Documents/rocketseat/nwl-together-reactjs/letmeask/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useEffect,useState}from'react';import{auth,firebase}from'../services/firebase';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext({});export function AuthContextProvider(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];useEffect(function(){var unsubscribe=auth.onAuthStateChanged(function(user){if(user){var displayName=user.displayName,photoURL=user.photoURL,uid=user.uid;if(!displayName||!photoURL){throw new Error('Missing information from Google Account.');}setUser({id:uid,name:displayName,avatar:photoURL});}});return function(){unsubscribe();};},[]);function signInWithGoogle(){return _signInWithGoogle.apply(this,arguments);}function _signInWithGoogle(){_signInWithGoogle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var provider,result,_result$user,displayName,photoURL,uid;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:provider=new firebase.auth.GoogleAuthProvider();_context.next=3;return auth.signInWithPopup(provider);case 3:result=_context.sent;if(!result.user){_context.next=9;break;}_result$user=result.user,displayName=_result$user.displayName,photoURL=_result$user.photoURL,uid=_result$user.uid;if(!(!displayName||!photoURL)){_context.next=8;break;}throw new Error('Missing information from Google Account.');case 8:setUser({id:uid,name:displayName,avatar:photoURL});case 9:case\"end\":return _context.stop();}}},_callee);}));return _signInWithGoogle.apply(this,arguments);}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user:user,signInWithGoogle:signInWithGoogle},children:props.children});}","map":{"version":3,"sources":["/home/brenoangelo/Documents/rocketseat/nwl-together-reactjs/letmeask/src/contexts/AuthContext.tsx"],"names":["createContext","useEffect","useState","auth","firebase","AuthContext","AuthContextProvider","props","user","setUser","unsubscribe","onAuthStateChanged","displayName","photoURL","uid","Error","id","name","avatar","signInWithGoogle","provider","GoogleAuthProvider","signInWithPopup","result","children"],"mappings":"8iBAAA,OAASA,aAAT,CAAmCC,SAAnC,CAA8CC,QAA9C,KAA8D,OAA9D,CAEA,OAASC,IAAT,CAAeC,QAAf,KAA+B,sBAA/B,C,2CAiBA,MAAO,IAAMC,CAAAA,WAAW,cAAGL,aAAa,CAAC,EAAD,CAAjC,CAEP,MAAO,SAASM,CAAAA,mBAAT,CAA6BC,KAA7B,CAA8D,eAEzCL,QAAQ,EAFiC,wCAE1DM,IAF0D,eAEpDC,OAFoD,eAGjER,SAAS,CAAC,UAAM,CACZ,GAAMS,CAAAA,WAAW,CAAGP,IAAI,CAACQ,kBAAL,CAAwB,SAAAH,IAAI,CAAI,CAChD,GAAIA,IAAJ,CAAU,IACEI,CAAAA,WADF,CACiCJ,IADjC,CACEI,WADF,CACeC,QADf,CACiCL,IADjC,CACeK,QADf,CACyBC,GADzB,CACiCN,IADjC,CACyBM,GADzB,CAGN,GAAI,CAACF,WAAD,EAAgB,CAACC,QAArB,CAA+B,CAC3B,KAAM,IAAIE,CAAAA,KAAJ,CAAU,0CAAV,CAAN,CACH,CACDN,OAAO,CAAC,CACJO,EAAE,CAAEF,GADA,CAEJG,IAAI,CAAEL,WAFF,CAGJM,MAAM,CAAEL,QAHJ,CAAD,CAAP,CAKH,CACJ,CAbmB,CAApB,CAeA,MAAO,WAAM,CACTH,WAAW,GACd,CAFD,CAGH,CAnBQ,CAmBN,EAnBM,CAAT,CAHiE,QAwBlDS,CAAAA,gBAxBkD,0JAwBjE,6LACUC,QADV,CACqB,GAAIhB,CAAAA,QAAQ,CAACD,IAAT,CAAckB,kBAAlB,EADrB,uBAGyBlB,CAAAA,IAAI,CAACmB,eAAL,CAAqBF,QAArB,CAHzB,QAGUG,MAHV,mBAKQA,MAAM,CAACf,IALf,sCAM+Ce,MAAM,CAACf,IANtD,CAMgBI,WANhB,cAMgBA,WANhB,CAM6BC,QAN7B,cAM6BA,QAN7B,CAMuCC,GANvC,cAMuCA,GANvC,MAQY,CAACF,WAAD,EAAgB,CAACC,QAR7B,+BASkB,IAAIE,CAAAA,KAAJ,CAAU,0CAAV,CATlB,QAYQN,OAAO,CAAC,CACJO,EAAE,CAAEF,GADA,CAEJG,IAAI,CAAEL,WAFF,CAGJM,MAAM,CAAEL,QAHJ,CAAD,CAAP,CAZR,sDAxBiE,mDA4CjE,mBACI,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEL,IAAI,CAAJA,IAAF,CAAQW,gBAAgB,CAAhBA,gBAAR,CAA7B,UACKZ,KAAK,CAACiB,QADX,EADJ,CAKH","sourcesContent":["import { createContext, ReactNode, useEffect, useState } from 'react'\r\n\r\nimport { auth, firebase } from '../services/firebase'\r\n\r\ntype User = {\r\n    id: string;\r\n    name: string;\r\n    avatar: string;\r\n}\r\n\r\ntype AuthContextType = {\r\n    user: User | undefined;\r\n    signInWithGoogle: () => Promise<void>;\r\n}\r\n\r\ntype AuthContextProviderProps = {\r\n    children: ReactNode;\r\n}\r\n\r\nexport const AuthContext = createContext({} as AuthContextType);\r\n\r\nexport function AuthContextProvider(props: AuthContextProviderProps) {\r\n\r\n    const [user, setUser] = useState<User>()\r\n    useEffect(() => {\r\n        const unsubscribe = auth.onAuthStateChanged(user => {\r\n            if (user) {\r\n                const { displayName, photoURL, uid } = user;\r\n\r\n                if (!displayName || !photoURL) {\r\n                    throw new Error('Missing information from Google Account.')\r\n                }\r\n                setUser({\r\n                    id: uid,\r\n                    name: displayName,\r\n                    avatar: photoURL\r\n                })\r\n            }\r\n        })\r\n\r\n        return () => {\r\n            unsubscribe();\r\n        }\r\n    }, [])\r\n\r\n    async function signInWithGoogle() {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n\r\n        const result = await auth.signInWithPopup(provider)\r\n\r\n        if (result.user) {\r\n            const { displayName, photoURL, uid } = result.user;\r\n\r\n            if (!displayName || !photoURL) {\r\n                throw new Error('Missing information from Google Account.')\r\n            }\r\n\r\n            setUser({\r\n                id: uid,\r\n                name: displayName,\r\n                avatar: photoURL\r\n            })\r\n        }\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, signInWithGoogle }}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}